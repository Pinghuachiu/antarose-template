# Claude Code 開發工作流程指南

## 概述

本文檔描述了 Claude Code 項目的標準開發工作流程。該流程基於敏捷開發原則，結合了產品管理、項目管理和技術實現的最佳實踐。

## 完整開發流程

### 選擇一：從頭開始（沒有需求文檔）
1. 項目初始化 (/pinit)
2. 產品需求分析 (/pda) - 生成需求文檔
3. 項目管理分析 (/pma) - 分析需求文檔
4. 項目管理計劃 (/pmp) - 制定執行計劃
5. 執行軟體開發 (/sfd) - 軟體開發測試
6. 執行DevOps建置 (/dps) - DevOps建置


### 選擇二：已有需求文檔
1. 項目初始化 (/pinit)
2. 項目管理分析 (/pma) - 分析現有需求文檔
3. 項目管理計劃 (/pmp) - 制定執行計劃
4. 執行軟體開發 (/sfd) - 軟體開發測試
5. 執行DevOps建置 (/dps) - DevOps建置


## 詳細流程說明

### 項目初始化階段
- 建立標準目錄結構
- 初始化版本控制系統
- 設置開發環境
- 創建文檔模板

### 需求分析階段（僅適用於選擇一）
- 市場和競爭分析
- 用戶需求調研
- 功能需求定義
- 技術可行性評估
- 生成需求文檔 (./docs/req.md)

### 計劃制定階段
- 讀取需求文檔 (./docs/req.md)
- 任務分解和分配
- 技術架構設計
- 風險識別和緩解
- 資源和時間規劃
- 生成項目開發計劃 (./docs/prd.md)

### 執行階段
- 讀取項目開發計劃 (./docs/prd.md)
- 並行開發
- 持續集成
- 自動化測試
- 進度跟蹤

### 驗證階段
- 功能測試
- 性能測試
- 用戶驗收測試
- 部署準備

## 版本控制策略

### 分支策略 (GitFlow)

本項目採用 GitFlow 分支模型進行版本控制，確保開發流程的規範性和可追溯性。

#### 分支類型及用途

1. **main 分支**
   - 用途：存放生產環境的穩定代碼
   - 保護：禁止直接提交，僅允許通過合併請求合併
   - 命名：固定為 `main`

2. **develop 分支**
   - 用途：集成所有功能開發的主開發分支
   - 保護：禁止直接提交，僅允許通過合併請求合併
   - 命名：固定為 `develop`

3. **feature 分支**
   - 用途：開發新功能的分支
   - 創建：從 `develop` 分支創建
   - 合併：開發完成後合併回 `develop`
   - 命名：`feature/issue_xxx`，其中 xxx 為對應的任務編號或功能描述

4. **release 分支**
   - 用途：準備發布新版本的分支
   - 創建：從 `develop` 分支創建
   - 合併：同時合併到 `main` 和 `develop`
   - 命名：`release/vX.X.X`，其中 X.X.X 為版本號

5. **hotfix 分支**
   - 用途：修復生產環境緊急問題的分支
   - 創建：從 `main` 分支創建
   - 合併：同時合併到 `main` 和 `develop`
   - 命名：`hotfix/issue_xxx` 或 `hotfix/vX.X.X`

#### 分支操作流程

1. **功能開發流程**
   ```
   git checkout develop
   git pull origin develop
   git checkout -b feature/issue_xxx
   # 開發功能
   git add .
   git commit -m "feat: 實現功能描述"
   git push origin feature/issue_xxx
   # 創建合併請求 (PR/MR)
   # 代碼審查通過後合併到 develop
   ```

2. **發布流程**
   ```
   git checkout develop
   git pull origin develop
   git checkout -b release/vX.X.X
   # 版本測試和修復
   git add .
   git commit -m "chore: 準備 vX.X.X 發布"
   git push origin release/vX.X.X
   # 測試通過後合併到 main 和 develop
   ```

3. **緊急修復流程**
   ```
   git checkout main
   git pull origin main
   git checkout -b hotfix/issue_xxx
   # 修復問題
   git add .
   git commit -m "fix: 修復生產環境問題"
   git push origin hotfix/issue_xxx
   # 測試通過後合併到 main 和 develop
   ```

### 分支命名規範

為確保分支命名的一致性和可讀性，遵循以下命名規範：

1. **功能分支**：`feature/issue_xxx`
   - xxx 為功能描述或任務編號
   - 例如：`feature/issue_123`、`feature/user-authentication`

2. **發布分支**：`release/vX.X.X`
   - 使用語義化版本號
   - 例如：`release/v1.2.0`

3. **修復分支**：`hotfix/issue_xxx` 或 `hotfix/vX.X.X`
   - 例如：`hotfix/issue_456`、`hotfix/v1.2.1`

### 代碼審查流程

為確保代碼質量和知識共享，所有合併到主分支的代碼都必須經過代碼審查：

1. **創建合併請求**
   - 開發完成後，在對應平台上創建合併請求 (Pull Request/Merge Request)
   - 填寫清晰的描述，包括變更內容、解決的問題和測試情況

2. **指派審查人員**
   - 指派至少一名團隊成員進行代碼審查
   - 審查人員應該具備相關技術背景

3. **審查標準**
   - 代碼符合項目編碼規範
   - 功能實現正確且完整
   - 包含適當的測試用例
   - 代碼可讀性和可維護性良好
   - 沒有明顯的性能問題或安全漏洞

4. **審查反饋**
   - 審查人員應提供具體、建設性的反饋
   - 開發人員根據反饋進行修改
   - 修改後重新提交審查

5. **合併條件**
   - 所有審查意見都已解決
   - CI/CD 流程通過
   - 獲得必要的批准

### 提交訊息指南

為確保提交歷史的清晰和可追溯性，遵循約定式提交規範：

#### 提交格式
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

#### 提交類型
- `feat`: 新功能
- `fix`: 修復錯誤
- `chore`: 日常維護任務
- `docs`: 文檔更新
- `style`: 代碼格式調整（不影響功能）
- `refactor`: 重構（不新增功能，不修復錯誤）
- `perf`: 性能優化
- `test`: 測試相關變更

#### 提交範例
```
feat(auth): 實現用戶登入驗證功能

- 添加登入表單組件
- 集成 JWT 認證機制
- 添加輸入驗證

Closes #123
```

```
fix(api): 修復用戶資料更新失敗問題

- 修正資料驗證邏輯
- 更新錯誤處理機制

Fixes #456
```

### 合併和發布程序

#### 合併程序

1. **合併前檢查**
   - 確保所有測試通過
   - 確認代碼審查已完成並獲得批准
   - 確認沒有衝突需要解決

2. **合併操作**
   - 使用快進合併 (fast-forward) 對於功能分支到 develop
   - 使用常規合併 (merge commit) 對於 release 和 hotfix 分支
   - 不允許使用壓縮合併 (squash merge)

3. **合併後操作**
   - 刪除已合併的分支
   - 更新相關文檔

#### 發布程序

1. **發布準備**
   - 在 develop 分支上確認所有功能都已完成且測試通過
   - 創建 release 分支並更新版本號
   - 進行發布候選版本的全面測試

2. **發布執行**
   - 將 release 分支合併到 main 分支
   - 在 main 分支上打標籤 (tag)
   - 將發布版本部署到生產環境

3. **發布後操作**
   - 將 release 分支的變更合併回 develop 分支
   - 清理已合併的分支
   - 通知相關人員發布完成

## 並行開發機制

### 任務分配原則
- 根據技能專長分配任務
- 考慮任務依賴關係
- 最大化並行效率
- 確保負載均衡

### 協作機制
- 定期同步進度
- 及時溝通阻塞問題
- 代碼審查制度
- 知識分享會議

## 質量保證

### 代碼質量
- 代碼審查
- 單元測試覆蓋率 > 80%
- 集成測試
- 靜態代碼分析

### 測試策略
- 自動化測試為主
- 手動測試為輔
- 持續測試集成
- 測試報告生成

## 部署流程

### 持續集成
- 代碼提交自動觸發
- 自動化構建和測試
- 質量門禁檢查
- 部署包生成

### 持續部署
- 多環境部署支持
- 藍綠部署策略
- 回滾機制
- 監控和告警

## 最佳實踐

### 開發實踐
1. 遵循 SOLID 原則
2. 編寫清晰的文檔
3. 保持代碼簡潔
4. 及時重構技術債務

### 團隊協作
1. 每日站會
2. 迭代回顧
3. 知識分享
4. 持續改進

### 風險管理
1. 早期識別風險
2. 制定緩解措施
3. 定期風險評估
4. 應急預案準備

## 常見問題和解決方案

### 流程問題
- **問題**：任務依賴導致阻塞
  **解決方案**：重新評估任務優先級，調整開發順序

- **問題**：需求變更頻繁
  **解決方案**：建立變更控制流程，評估影響範圍

### 技術問題
- **問題**：技術債務累積
  **解決方案**：安排專門時間進行重構，建立技術債務跟踪機制

- **問題**：性能瓶頸
  **解決方案**：建立性能基線，定期性能測試

## 附錄

### 命令參考
- `/pinit` - 初始化項目
- `/pda` - 產品需求分析（僅在沒有需求文檔時使用）
- `/pma` - 項目管理分析
- `/pmp` - 項目管理計劃
- `/exetask` - 執行任務

### 模板文件
- 需求文檔模板
- PRD 模板
- 技術設計文檔模板
- 測試計劃模板